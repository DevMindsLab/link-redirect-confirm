{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://devmindslab-link-redirect-confirm/webpack/bootstrap","webpack://devmindslab-link-redirect-confirm/webpack/runtime/compat get default export","webpack://devmindslab-link-redirect-confirm/webpack/runtime/define property getters","webpack://devmindslab-link-redirect-confirm/webpack/runtime/hasOwnProperty shorthand","webpack://devmindslab-link-redirect-confirm/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://devmindslab-link-redirect-confirm/external root \"flarum.core.compat['forum/app']\"","webpack://devmindslab-link-redirect-confirm/external root \"flarum.core.compat['common/components/Modal']\"","webpack://devmindslab-link-redirect-confirm/external root \"flarum.core.compat['common/components/Button']\"","webpack://devmindslab-link-redirect-confirm/./src/forum/index.js","webpack://devmindslab-link-redirect-confirm/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\n\nclass ConfirmExternalLinkModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.url = vnode.attrs.url;\n  }\n\n  className() {\n    return 'Modal--small LinkRedirectConfirmModal';\n  }\n\n  title() {\n    return app.translator.trans('devmindslab-link-redirect-confirm.forum.modal.title');\n  }\n\n  content() {\n    const displayUrl = this.url || '';\n    return (\n      <div className=\"Modal-body\">\n        <p>\n          {app.translator.trans('devmindslab-link-redirect-confirm.forum.modal.body')}\n        </p>\n        {displayUrl ? (\n          <p className=\"LinkRedirectConfirmModal-link\">\n            {app.translator.trans('devmindslab-link-redirect-confirm.forum.modal.link', {\n              url: displayUrl,\n            })}\n          </p>\n        ) : null}\n        <div className=\"Form-group\">\n          {Button.component(\n            {\n              className: 'Button Button--secondary',\n              onclick: () => this.hide(),\n            },\n            app.translator.trans('devmindslab-link-redirect-confirm.forum.modal.cancel')\n          )}\n          <a\n            className=\"Button Button--primary\"\n            href={this.url || '#'}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            data-no-redirect-confirm=\"1\"\n            onclick={() => this.hide()}\n          >\n            {app.translator.trans('devmindslab-link-redirect-confirm.forum.modal.confirm')}\n          </a>\n        </div>\n      </div>\n    );\n  }\n\n  // Opening is handled by the confirm button link (real <a>).\n}\n\nfunction getForumBaseUrl() {\n  return (\n    (app.forum && app.forum.attribute && app.forum.attribute('baseUrl')) ||\n    (app.forum && app.forum.attribute && app.forum.attribute('base_url')) ||\n    (app.data && app.data.attributes && app.data.attributes.baseUrl) ||\n    ''\n  );\n}\n\nfunction parseWhitelist(raw) {\n  if (!raw) return [];\n  return raw\n    .split(/[,\\s]+/)\n    .map((s) => s.trim())\n    .filter(Boolean);\n}\n\nfunction getWhitelistSetting() {\n  return (\n    (app.forum && app.forum.attribute && app.forum.attribute('linkRedirectConfirmWhitelist')) ||\n    (app.data && app.data.attributes && app.data.attributes.linkRedirectConfirmWhitelist) ||\n    (app.data && app.data.settings && app.data.settings['devmindslab-link-redirect-confirm.whitelist']) ||\n    ''\n  );\n}\n\nfunction normalizeWhitelistEntry(entry) {\n  if (!entry) return '';\n  let value = entry.trim();\n\n  // Strip scheme if provided\n  value = value.replace(/^https?:\\/\\//i, '');\n\n  // Drop any path/query/fragment/port\n  value = value.split('/')[0];\n  value = value.split('?')[0];\n  value = value.split('#')[0];\n\n  return value.trim();\n}\n\nfunction hostnameMatches(hostname, entry) {\n  if (!entry) return false;\n  const normalized = normalizeWhitelistEntry(entry);\n  const clean = normalized.replace(/^\\*\\./, '').toLowerCase();\n  const host = hostname.toLowerCase();\n  return host === clean || host.endsWith(`.${clean}`);\n}\n\nfunction isWhitelisted(hostname, whitelist) {\n  return whitelist.some((entry) => hostnameMatches(hostname, entry));\n}\n\nfunction isExternalLink(url, baseHost, whitelist) {\n  if (!url || !url.hostname) return false;\n\n  if (url.hostname.toLowerCase() === baseHost.toLowerCase()) return false;\n  if (isWhitelisted(url.hostname, whitelist)) return false;\n\n  return true;\n}\n\nfunction shouldIgnoreClick(event, anchor) {\n  if (!anchor || !anchor.href) return true;\n  if (anchor.hasAttribute('data-no-redirect-confirm')) return true;\n  if (event.defaultPrevented) return true;\n  if (event.button && event.button !== 0) return true; // ignore middle/right click\n  return false;\n}\n\napp.initializers.add('devmindslab-link-redirect-confirm', () => {\n  const baseUrl = getForumBaseUrl();\n  let baseHost = '';\n\n  try {\n    baseHost = new URL(baseUrl).hostname;\n  } catch (e) {\n    baseHost = window.location.hostname;\n  }\n\n  document.addEventListener(\n    'click',\n    (event) => {\n      const anchor = event.target && event.target.closest ? event.target.closest('a') : null;\n      if (shouldIgnoreClick(event, anchor)) return;\n\n      let url;\n      try {\n        url = new URL(anchor.getAttribute('href'), baseUrl || window.location.href);\n      } catch (e) {\n        return;\n      }\n\n      if (!['http:', 'https:'].includes(url.protocol)) return;\n\n      const whitelistSetting = getWhitelistSetting();\n      const whitelist = parseWhitelist(whitelistSetting).concat([baseHost]);\n\n      const isExternal = isExternalLink(url, baseHost, whitelist);\n      if (!isExternal) return;\n\n      if (isWhitelisted(url.hostname, whitelist)) return;\n\n      event.preventDefault();\n      event.stopPropagation();\n\n      app.modal.show(ConfirmExternalLinkModal, {\n        url: url.href,\n      });\n    },\n    true\n  );\n});\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","flarum","core","compat","ConfirmExternalLinkModal","_Modal","apply","arguments","create","constructor","_proto","oninit","vnode","this","url","attrs","className","title","app","trans","content","_this","displayUrl","m","Button","onclick","hide","href","target","rel","Modal","isWhitelisted","hostname","whitelist","some","entry","normalized","value","trim","replace","split","normalizeWhitelistEntry","clean","toLowerCase","host","endsWith","hostnameMatches","add","baseUrl","attribute","attributes","baseHost","URL","window","location","document","addEventListener","event","anchor","closest","hasAttribute","defaultPrevented","button","shouldIgnoreClick","getAttribute","includes","protocol","raw","linkRedirectConfirmWhitelist","settings","map","s","filter","Boolean","concat","isExternal","isExternalLink","preventDefault","stopPropagation","show"],"ignoreList":[],"sourceRoot":""}